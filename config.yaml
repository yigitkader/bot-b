# Trading Bot Configuration - Clean Architecture
# ✅ ACTION PLAN: Safe Mode Configuration for Profitability
# 
# Strategy Focus:
# - Multi-Timeframe Confluence (MTF): Primary strategy - requires 75%+ alignment (5m, 15m, 1h)
# - Enhanced Signal Scoring: Enabled - superior to individual indicators
# - Order Flow: Disabled until real orderbook data available
# - Risk Management: Conservative leverage (10x), auto-close on WebSocket disconnect
#
# Paper Trading: Test with virtual money for 1 week before going live
# Analyze logs/paper_trading_orders.log for slippage and latency effects

symbols: []
auto_discover_quote: true
quote_asset: "USDC"
allow_usdt_quote: true
mode: "futures"

max_usd_per_order: 100.0
min_usd_per_order: 10.0
min_margin_usd: 10.0
max_margin_usd: 100.0
margin_strategy: "balance_based"
min_quote_balance_usd: 20.0

leverage: 10  # ✅ ACTION PLAN: Safe mode - 10x leverage. Conservative approach for profitability. If algorithm is successful, it will profit with lower leverage.

price_tick: 0.001
qty_step: 0.001

take_profit_pct: 0.35
stop_loss_pct: 0.12

trending:
  ema_fast_period: 21
  ema_slow_period: 55
  rsi_period: 14
  atr_period: 14
  warmup_min_ticks: 70
  min_spread_bps: 0.01
  max_spread_bps: 200.0
  signal_cooldown_seconds: 12
  hft_mode: false  # ✅ FIX: Disabled HFT mode. HFT requires co-location (physical proximity to Binance servers). With home internet or standard VPS, latency causes losses. Use trend_threshold_normal strategy instead.
  require_volume_confirmation: false
  base_min_score: 6.5
  trend_threshold_hft: 0.5
  trend_threshold_normal: 0.6
  weak_trend_score_multiplier: 1.15
  regime_multiplier_trending: 0.9
  regime_multiplier_ranging: 1.15
  rsi_lower_long: 40.0
  rsi_upper_long: 65.0
  atr_sl_multiplier: 2.0
  atr_tp_multiplier: 4.0
  # Enhanced Signal Scoring (TrendPlan.md) - Professional 0-100 point scoring
  enable_enhanced_scoring: true  # Enhanced scoring aktif
  enhanced_score_excellent: 70.0  # 70-100: Excellent signal (take it!)
  enhanced_score_good: 55.0        # 55-69: Good signal (take it)
  enhanced_score_marginal: 40.0    # 40-54: Marginal signal (skip)
  # Order Flow Analysis (TrendPlan.md - Action Plan)
  enable_order_flow: false  # ✅ ACTION PLAN: Disabled until real orderbook data stream is available. Backtest uses SIMULATED data which is misleading. Focus on MTF Confluence strategy instead.
  # Execution & Backtest Parameters (no hardcoded values)
  fee_bps_round_trip: 10.0  # ✅ ACTION PLAN: Round-trip fee in basis points (10.0 = 0.10%) - Binance VIP 0 realistic. Minimum 10.0 recommended for realistic backtest results, especially with HFT mode.
  max_holding_bars: 48  # Maximum holding time in bars (48 = 4 hours @5m)
  slippage_bps: 15.0  # ✅ FIX (Plan.md): Increased from 5.0 to 15.0 (0.15%). Plan.md recommends conservative approach - in crisis moments or volatile coins, slippage can be 20-30 bps. Setting to 15 bps for worst-case scenario backtesting ensures realistic results. Real markets always have slippage, especially during volatility.
  min_holding_bars: 3  # Minimum holding time in bars (3 = 15 minutes @5m)
  # Signal Quality Filtering (configurable)
  min_volume_ratio: 1.5  # Minimum volume ratio vs 20-bar average
  max_volatility_pct: 2.0  # Maximum ATR volatility % (2.0 = 2%)
  max_price_change_5bars_pct: 3.0  # Max price change in 5 bars % (3.0 = 3%)
  enable_signal_quality_filter: true  # Enable signal quality filtering

binance:
  futures_base: "https://fapi.binance.com"
  api_key: ""
  secret_key: ""
  recv_window_ms: 5000
  hedge_mode: false

risk:
  max_leverage: 20  # ✅ FIX: Reduced from 200x to 20x (safe maximum). Matches the safe leverage range (10x-20x).
  use_isolated_margin: true
  max_position_notional_usd: 30000.0
  maker_commission_pct: 0.02
  taker_commission_pct: 0.04
  # Liquidation cluster aggregation window (seconds)
  # Lower values (10-20s) for high volatility markets
  # Higher values (30-60s) for stable markets
  # Default: 30 seconds
  liq_window_secs: 30
  # Risk Management - Correlation & Portfolio Limits
  correlation_threshold: 0.7  # High correlation threshold (0.7 = 70%)
  max_correlated_positions: 5  # Max correlated positions in same direction
  max_correlated_notional_pct: 0.5  # Max % of total notional in correlated positions (0.5 = 50%)
  max_position_per_symbol_pct: 0.3  # Max % of total notional per symbol (0.3 = 30%)
  correlation_cache_update_interval_secs: 600  # ✅ FIX: Increased from 60s to 600s (10 minutes). Reduces CPU load when tracking 100+ coins. Correlation doesn't change rapidly.
  correlation_cache_retention_minutes: 10  # ✅ FIX: Increased from 5 to 10 minutes. Longer retention reduces recalculation overhead.
  max_daily_drawdown_pct: 0.05  # Max daily drawdown (0.05 = 5%)
  max_weekly_drawdown_pct: 0.10  # Max weekly drawdown (0.10 = 10%)
  risk_per_trade_pct: 0.01  # Risk per trade as % of equity (0.01 = 1%)
  # ✅ ACTION PLAN: WebSocket Disconnection Strategy
  # If WebSocket disconnects for more than timeout_secs, close all positions for safety
  # This prevents trading with stale data which can cause significant losses
  ws_disconnect_close_positions: true  # ✅ ACTION PLAN: Enable auto-close on WebSocket disconnect
  ws_disconnect_timeout_secs: 30  # Close positions if WebSocket disconnected for 30+ seconds

websocket:
  enabled: true
  reconnect_delay_ms: 5000
  ping_interval_ms: 30000

exec:
  tif: "post_only"
  default_leverage: 20

  min_profit_usd: 0.50
  max_position_duration_sec: 60.0
  max_loss_duration_sec: 30.0

  time_weighted_threshold_early: 0.3
  time_weighted_threshold_normal: 0.5
  time_weighted_threshold_mid: 0.3
  time_weighted_threshold_late: 0.2

  trailing_stop_threshold_ratio: 0.5
  max_loss_threshold_ratio: 2.0
  stop_loss_threshold_ratio: 0.8

event_bus:
  # Buffer sizes optimized for memory efficiency
  # Market tick: 1 msg/sec, 2000 buffer = ~33 min data, ~400 KB memory
  market_tick_buffer: 2000
  # Trade signals: Low frequency, 500 buffer sufficient
  trade_signal_buffer: 500
  # Close requests: Low frequency, 500 buffer sufficient
  close_request_buffer: 500
  # Order updates: Medium frequency, 1000 buffer sufficient
  order_update_buffer: 1000
  # Position updates: Low frequency, 500 buffer sufficient
  position_update_buffer: 500
  # Balance updates: Very low frequency (30s interval), 100 buffer sufficient
  balance_update_buffer: 100
  # Metrics cache update interval (seconds) - Funding/OI/LSR cache refresh rate
  # Default: 300 (5 minutes) - balance between freshness and rate limit
  metrics_cache_update_interval_secs: 300

dynamic_symbol_selection:
  enabled: true
  max_symbols: 30
  rotation_interval_minutes: 15

  min_volatility_pct: 1.5
  min_quote_volume: 1000000
  min_trades_24h: 1000

  volatility_weight: 2.0
  volume_weight: 1.0
  trades_weight: 0.5
  spread_weight: 1.0
  
  # Minimum balance (USDT/USDC) required to scan symbols for that quote asset
  # If balance < min_balance_threshold, symbols with that quote will be excluded
  # Default: 10.0 USD
  min_balance_threshold: 10.0

# ✅ ACTION PLAN: Paper Trading Mode
# Test bot with real market data but virtual money before going live
# Run for 1 week and analyze logs/paper_trading_orders.log for slippage and latency effects
paper_trading:
  enabled: true  # ✅ ACTION PLAN: Enabled for paper trading mode (virtual orders, real data). Test for 1 week before going live.
  log_file: "logs/paper_trading_orders.log"  # Log file for virtual orders (analyze slippage/latency)
